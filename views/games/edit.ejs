<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/stylesheet/edit-page.css">

    <title>Document</title>
</head>
<body>
    <div class="container">
        <h1>
            Edit game
        </h1>
        <form action="/games/<%= game._id %>?_method=PUT" method="POST" enctype="multipart/form-data">
            <div class="form-elem" id="nameDiv">
                <label for="name">Game Name</label>
                <input type="text" name="name" value="<%= game.name%>"  required>
            </div>
            <div class="form-elem" id="iconDiv">
                <label for="gameIcon">Add game Icon</label>
                <div class="preview">
                    <p>Current Icon</p>
                    <img src="" alt="Game Icon">
                </div>
                <input type="file" name="gameIcon" value=""  accept="image/*">

                

            </div>
            <div class="form-elem" id="backgroundImageDiv">
                <label for="backgroundImage">Add game page background Image</label>
                <div class="preview">
                    <p>Current Icon:</p>
                    <img src="" alt="Game Icon" style="max-width: 150px;"> 
                </div>
                <input type="file" name="backgroundImage" value="" accept="image/*">
            </div>
            <div class= "form-elem" id="gallery-div">
                <label for="gallery">More media </label>
                <input type="file" name="gallery" id="gallery-input" accept="image/*" multiple>
                <button type="button">Remove all</button>
            </div>
            <button type="submit">Submit</button>

        </form>

    </div>
    <div id="decoration">

    </div>
    <%- include("../../partials/_message.ejs") %>
</body>
<script>
    const game =  <%-JSON.stringify(game)%>;
    const iconDiv = document.querySelector("#iconDiv");
    if(game.gameIcon){
        const preview = iconDiv.children[1];
        preview.style.display = "block";
        const previewImage = preview.children[1];
        previewImage.src = game.gameIcon;
    }
    const iconSelect = iconDiv.children[2];
    iconSelect.addEventListener("change", ()=>{
        
        const preview = iconDiv.children[1];
        preview.style.display = "block";
        const previewImage = preview.children[1];
        const file = iconSelect.files[0];
        if(file){
            previewImage.src =  URL.createObjectURL(file)  ;
        }
        
    })

    const backgroundImageDiv = document.querySelector("#backgroundImageDiv");

     if(game.backgroundImage){
        const preview = backgroundImageDiv.children[1];
        preview.style.display = "block";
        const previewImage = preview.children[1];
        previewImage.src = game.backgroundImage;
    }
    const backgroundSelect = backgroundImageDiv.children[2];
    backgroundSelect.addEventListener("change", ()=>{
        
        const preview = backgroundImageDiv.children[1];
        preview.style.display = "block";
        const previewImage = preview.children[1];
        const file = backgroundSelect.files[0];
        if(file){
            previewImage.src =  URL.createObjectURL(file)  ;
        }
        
    })



    const divElem =  document.querySelector("#gallery-div");
    
    if(game.gallery && game.gallery.length>0){
        game.gallery.forEach((image)=>{
            const preview = document.createElement("div");
            preview.classList.add("preview");
            preview.style.display = "block";
            const img = document.createElement("img");
            img.src = image;
            img.alt = "Game images"
            img.style = "max-width: 150px; display: block";
            preview.append(img);
            divElem.appendChild(preview);
        })
    }

    const inputElem = document.querySelector("#gallery-input");
    divElem.children[2].addEventListener("click",()=>{
        inputElem.value = "";
        for (let index = 0; index < divElem.children.length; index++) {
            const element = divElem.children[index];
            if(element.classList.contains("preview")){
                element.remove();
            }
            
        }
    })
    inputElem.addEventListener("change",()=>{
        console.log(Array.from(inputElem.files))
        Array.from(inputElem.files).forEach((file)=>{
            const preview = document.createElement("div");
            preview.classList.add("preview");
            preview.style.display = "block";
            const img = document.createElement("img");
            if(file){
                img.src = URL.createObjectURL(file);
                console.log(img.src)
                img.alt = "Game images";
                img.style = "max-width: 150px; display: block";
                preview.append(img);
                divElem.appendChild(preview);
                console.log(divElem)
            }
            
        })
    })
</script>
</html>